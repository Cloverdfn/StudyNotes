# 2.4 进程同步与互斥

* 进程同步的主要任务是使并发执行的诸进程之间能有效地共享资源和相互合作，从而使程序的执行**具有可再现性**。

### 2.4.1 进程与资源

* 1、资源的概念
    * 1>资源
        * 软件资源（程序和数据）
        * 硬件资源（CPU、内存、外设）

    * 2>资源
        * 共享资源（允许多个进程同时访问的资源。如内存和硬盘等。）
        * 临界资源（**在一段时间内仅允许一个进程使用资源。如打印机、输入机、磁带机、信号量和指针等**，也可能是一些共享变量、表格、链表等。**临界资源可以互斥共享**；生产者-消费者(producer-consumer)问题是一个著名的进程同步问题。另外一个飞机订票系统的两个终端也要进行同步。）

* 2、两种形式的制约关系 
    * 间接相互制约关系。（打印机）
    * 直接相互制约关系。 （ICP）

* 3、进程与资源的关系

  <div align="center"><img src="./img/进程与资源的关系.png"/></div>

    >可见，操作系统的任务是控制与管理进程和资源，必须提供一些机制来协调进程与进程之间、进程与资源之间的复杂关系。

* 4、临界资源
    * 生产者-消费者(producer-consumer)问题是一个著名的进程同步问题。
    
    >它描述的是：有一群生产者进程在生产产品，并将这些产品提供给消费者进程去消费。为使生产者进程与消费者进程能并发执行，在两者之间设置了一个具有n个缓冲区的缓冲池，生产者进程将它所生产的产品放入一个缓冲区中； 消费者进程可从一个缓冲区中取走产品去消费。尽管所有的生产者进程和消费者进程都是以异步方式运行的，但它们之间必须保持同步，即不允许消费者进程到一个空缓冲区去取产品；也不允许生产者进程向一个已装满产品且尚未被取走的缓冲区中投放产品。 

* 5、临界区(critical section) 
    * 每个进程中访问临界资源的那段代码称为临界区。
        * 进入区
        * 临界区
        * 退出区
        * 剩余区

  <div align="center"><img src="./img/临界区.png"/></div>


### 2.4.2  进程的互斥与同步

* 1、同步与互斥的概念
    * 进程**互斥**是指多个进程不能同时使用同一个临界资源，由于竞争同一个资源而相互制约就称为进程的互斥。
    * 进程的**同步**是指有协作关系的进程之间不断调整他们之间的相对速度或执行过程，以保证临界资源的合理利用和进程的顺利执行。
    * 实际上可以认为互斥是同步的一种特殊形式。
    * 实现进程同步的机制称为进程同步机制。一般包括信号量、加锁操作等。

* 2、同步机制应遵循的准则 
    * 1)空闲让进
    * 2)忙则等待 
    * 3)有限等待 
    * 4)让权等待  

### 2.4.3  锁机制(* 硬件同步机制)

* 即提供一对上锁和开锁原语以及一个锁变量W或是锁位。当进程进入临界区之前，首先测试W的状态。当W=0表示上锁，该资源已被占用，W=1表示开锁，该资源空闲，未被占用。
* 这种方法安全可靠，但效率不高，因为上锁原语中W=0情况反复循环测试直到时间片耗完为止，因此浪费了处理机时间。



























